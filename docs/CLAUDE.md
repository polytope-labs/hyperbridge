# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Next.js documentation site for Hyperbridge built with Fumadocs, a documentation framework. The site serves three separate documentation sections:
- **Developers** (`/docs/developers`) - Backend/protocol integration docs
- **Frontend** (`/docs/ui`) - Frontend integration docs
- **Protocol** (`/docs/protocol`) - Core protocol specification

## Development Commands

```bash
# Install dependencies
pnpm install

# Start development server (runs on port 4010, not default 3000)
pnpm dev

# Build for production
pnpm build

# Type checking (generates MDX types and runs TypeScript compiler)
pnpm types:check

# Linting
pnpm lint

# Code formatting
pnpm format
```

The dev server runs on **port 4010** (configured in package.json), not the default Next.js port 3000.

## Architecture

### Three-Source Documentation System

The project uses a multi-source architecture where each documentation section is completely independent:

1. **Content Collections** (source.config.ts:14-51)
   - `developers` → `content/developers/`
   - `ui` → `content/frontend/`
   - `protocol` → `content/protocol/`

   Each collection is defined separately with identical schemas but different directories.

2. **Source Loaders** (src/lib/source.ts:7-23)
   - `backendSource` → `/docs/developers`
   - `frontendSource` → `/docs/ui`
   - `protocolSource` → `/docs/protocol`

   Each loader creates a separate Fumadocs content source with its own base URL.

3. **Route Handlers** (src/app/docs/*)
   - Each section has its own Next.js app route with layout and [[...slug]] catch-all pages
   - Pages are nearly identical but reference different source loaders

### Search Implementation

The search API (src/app/api/search/route.ts) is unique - it queries all three sources in parallel and merges results. When modifying search:
- Each source has its own search index
- Results are combined using Promise.allSettled to handle failures gracefully
- All sources use English language configuration

### MDX Processing

The project uses a custom MDX pipeline (source.config.ts:53-69):
- **remark-math** + **rehype-katex** for LaTeX math rendering
- `includeProcessedMarkdown: true` enables text extraction for LLM consumption (see getLLMText in source.ts)
- Custom components: Algorithm (pseudocode rendering), plus Fumadocs callouts, steps, and tabs

### Path Aliases

TypeScript is configured with these path mappings (tsconfig.json:18-21):
- `@/*` → `./src/*` (standard Next.js convention)
- `fumadocs-mdx:collections/*` → `.source/*` (generated MDX types)
- `~/*` → `./*` (root-relative imports)

The `.source/` directory is auto-generated by `fumadocs-mdx` during postinstall and when running `types:check`.

## Content Structure

Documentation lives in three top-level directories under `content/`:

```
content/
├── developers/     # Backend integration docs (/docs/developers)
├── frontend/       # Frontend integration docs (/docs/ui)
└── protocol/       # Protocol specification (/docs/protocol)
```

Each directory:
- Contains an `index.mdx` as the landing page
- Has a `meta.json` for navigation structure
- Uses nested directories for organizing topics
- Supports all Fumadocs frontmatter (title, description, icon, etc.)

When adding new pages:
1. Create `.mdx` file in appropriate content directory
2. Update corresponding `meta.json` if changing navigation
3. Run `pnpm types:check` to regenerate types
4. The page will automatically be available at the route matching the file path

## Linting and Formatting

This project uses **Biome** (not ESLint/Prettier). Configuration in biome.json:
- Includes Next.js and React domain-specific rules
- Tailwind CSS parsing enabled
- 2-space indentation
- Auto-organizes imports on save

When fixing linting issues, run `pnpm format` to auto-fix formatting, then `pnpm lint` to check remaining issues.

## Key Technical Details

### OG Image Generation
Each documentation section has its own OpenGraph image route handler at `src/app/og/{developers,ui,protocol}/[...slug]/route.tsx`. The getPageImage functions in source.ts generate the correct OG image URLs.

### Custom Algorithm Component
The `<Algorithm>` component (src/components/algorithm.tsx) uses the `pseudocode` package to render algorithmic pseudocode with LaTeX-style formatting. Available in all MDX files - useful for protocol specification pages.

### Theme Configuration
The theme switcher is explicitly disabled (src/lib/layout.shared.tsx:8). The site uses a single theme. If re-enabling dark mode, update `themeSwitch.enabled` in baseOptions().

### Static Generation
All documentation pages use `generateStaticParams` for static site generation at build time. Pages are pre-rendered, not server-rendered per request.
